#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

/*
  Programa: WAR Estruturado - Sistema de Ataques entre Territ√≥rios
  Objetivo: Simular batalhas entre territ√≥rios usando structs, ponteiros e aloca√ß√£o din√¢mica.
  Autor: (Seu Nome)
  Data: (coloque a data do commit)
*/

// Defini√ß√£o da estrutura Territorio
typedef struct {
    char nome[30];
    char cor[10];
    int tropas;
} Territorio;

// Fun√ß√£o para cadastrar territ√≥rios dinamicamente
void cadastrarTerritorios(Territorio *mapa, int qtd) {
    for (int i = 0; i < qtd; i++) {
        printf("\n=== Cadastro do territ√≥rio %d ===\n", i + 1);
        printf("Nome: ");
        scanf(" %[^\n]", mapa[i].nome);
        printf("Cor do ex√©rcito: ");
        scanf(" %[^\n]", mapa[i].cor);
        printf("Quantidade de tropas: ");
        scanf("%d", &mapa[i].tropas);
    }
}

// Fun√ß√£o para exibir os territ√≥rios cadastrados
void exibirTerritorios(Territorio *mapa, int qtd) {
    printf("\n===== ESTADO ATUAL DOS TERRIT√ìRIOS =====\n");
    for (int i = 0; i < qtd; i++) {
        printf("\nTerrit√≥rio %d:\n", i + 1);
        printf("Nome: %s\n", mapa[i].nome);
        printf("Cor do ex√©rcito: %s\n", mapa[i].cor);
        printf("Tropas: %d\n", mapa[i].tropas);
    }
    printf("=========================================\n");
}

// Fun√ß√£o que simula um ataque entre dois territ√≥rios
void atacar(Territorio *atacante, Territorio *defensor) {
    // Valida√ß√£o: o atacante n√£o pode atacar um territ√≥rio da mesma cor
    if (strcmp(atacante->cor, defensor->cor) == 0) {
        printf("\n‚ùå Ataque inv√°lido! Voc√™ n√£o pode atacar um territ√≥rio da mesma cor.\n");
        return;
    }

    // Gerar n√∫meros aleat√≥rios simulando dados (1 a 6)
    int dadoAtacante = (rand() % 6) + 1;
    int dadoDefensor = (rand() % 6) + 1;

    printf("\nüé≤ Rolagem dos dados:\n");
    printf("%s (Atacante) tirou: %d\n", atacante->nome, dadoAtacante);
    printf("%s (Defensor) tirou: %d\n", defensor->nome, dadoDefensor);

    // Resultado do ataque
    if (dadoAtacante > dadoDefensor) {
        printf("\nüî• %s venceu a batalha!\n", atacante->nome);

        // O atacante conquista o territ√≥rio defensor
        strcpy(defensor->cor, atacante->cor);

        // O defensor perde metade das tropas e assume metade do atacante
        defensor->tropas = atacante->tropas / 2;

        printf("üè≥Ô∏è  O territ√≥rio %s agora pertence ao ex√©rcito %s!\n",
               defensor->nome, defensor->cor);
    } else {
        printf("\nüõ°Ô∏è  %s resistiu ao ataque!\n", defensor->nome);
        // O atacante perde uma tropa
        atacante->tropas--;
        if (atacante->tropas < 0)
            atacante->tropas = 0;
    }
}

// Fun√ß√£o para liberar a mem√≥ria alocada
void liberarMemoria(Territorio *mapa) {
    free(mapa);
    printf("\nüíæ Mem√≥ria liberada com sucesso.\n");
}

int main() {
    srand(time(NULL)); // Garante aleatoriedade dos dados

    int qtd;
    printf("===== JOGO WAR - SISTEMA DE TERRIT√ìRIOS =====\n");
    printf("Quantos territ√≥rios deseja cadastrar? ");
    scanf("%d", &qtd);

    // Aloca√ß√£o din√¢mica dos territ√≥rios
    Territorio *mapa = (Territorio *)calloc(qtd, sizeof(Territorio));
    if (mapa == NULL) {
        printf("Erro ao alocar mem√≥ria!\n");
        return 1;
    }

    // Cadastro inicial
    cadastrarTerritorios(mapa, qtd);
    exibirTerritorios(mapa, qtd);

    // Loop de ataques
    int opcao;
    do {
        printf("\nDeseja realizar um ataque? (1 - Sim / 0 - N√£o): ");
        scanf("%d", &opcao);

        if (opcao == 1) {
            int atq, def;
            exibirTerritorios(mapa, qtd);

            printf("\nEscolha o territ√≥rio atacante (1 a %d): ", qtd);
            scanf("%d", &atq);
            printf("Escolha o territ√≥rio defensor (1 a %d): ", qtd);
            scanf("%d", &def);

            // Valida √≠ndices
            if (atq < 1 || atq > qtd || def < 1 || def > qtd || atq == def) {
                printf("\n‚ùå Escolha inv√°lida!\n");
            } else {
                atacar(&mapa[atq - 1], &mapa[def - 1]);
                exibirTerritorios(mapa, qtd);
            }
        }

    } while (opcao != 0);

    liberarMemoria(mapa);
    printf("\nüëã Encerrando o jogo WAR.\n");

    return 0;
}
